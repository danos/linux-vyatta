From 64fd1de3d821659ac0a3004fd5ee1de59e64af30 Mon Sep 17 00:00:00 2001
From: Heiko Carstens <heiko.carstens@de.ibm.com>
Date: Wed, 14 Jan 2009 14:14:14 +0100
Subject: [PATCH 22/44] [CVE-2009-0029] System call wrappers part 12

From: Heiko Carstens <heiko.carstens@de.ibm.com>

commit 64fd1de3d821659ac0a3004fd5ee1de59e64af30 upstream.

Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

Backported to Debian's 2.6.26 by dann frazier <dannf@debian.org>

diff -urpN linux-source-2.6.26.orig/fs/xattr.c linux-source-2.6.26/fs/xattr.c
--- linux-source-2.6.26.orig/fs/xattr.c	2009-01-19 11:14:17.000000000 -0700
+++ linux-source-2.6.26/fs/xattr.c	2009-01-19 12:22:58.000000000 -0700
@@ -251,9 +251,9 @@ setxattr(struct dentry *d, const char __
 	return error;
 }
 
-asmlinkage long
-sys_setxattr(const char __user *path, const char __user *name,
-	     const void __user *value, size_t size, int flags)
+SYSCALL_DEFINE5(setxattr, const char __user *, path,
+		const char __user *, name, const void __user *, value,
+		size_t, size, int, flags)
 {
 	struct nameidata nd;
 	int error;
@@ -270,9 +270,9 @@ sys_setxattr(const char __user *path, co
 	return error;
 }
 
-asmlinkage long
-sys_lsetxattr(const char __user *path, const char __user *name,
-	      const void __user *value, size_t size, int flags)
+SYSCALL_DEFINE5(lsetxattr, const char __user *, path,
+		const char __user *, name, const void __user *, value,
+		size_t, size, int, flags)
 {
 	struct nameidata nd;
 	int error;
@@ -289,9 +289,8 @@ sys_lsetxattr(const char __user *path, c
 	return error;
 }
 
-asmlinkage long
-sys_fsetxattr(int fd, const char __user *name, const void __user *value,
-	      size_t size, int flags)
+SYSCALL_DEFINE5(fsetxattr, int, fd, const char __user *, name,
+		const void __user *,value, size_t, size, int, flags)
 {
 	struct file *f;
 	struct dentry *dentry;
@@ -349,9 +348,8 @@ getxattr(struct dentry *d, const char __
 	return error;
 }
 
-asmlinkage long
-sys_getxattr(const char __user *path, const char __user *name,
-	     void __user *value, size_t size)
+SYSCALL_DEFINE4(getxattr, const char __user *, path,
+		const char __user *, name, void __user *, value, size_t, size)
 {
 	struct nameidata nd;
 	ssize_t error;
@@ -364,9 +362,8 @@ sys_getxattr(const char __user *path, co
 	return error;
 }
 
-asmlinkage long
-sys_lgetxattr(const char __user *path, const char __user *name, void __user *value,
-	      size_t size)
+SYSCALL_DEFINE4(lgetxattr, const char __user *, path,
+		const char __user *, name, void __user *, value, size_t, size)
 {
 	struct nameidata nd;
 	ssize_t error;
@@ -379,8 +376,8 @@ sys_lgetxattr(const char __user *path, c
 	return error;
 }
 
-asmlinkage long
-sys_fgetxattr(int fd, const char __user *name, void __user *value, size_t size)
+SYSCALL_DEFINE4(fgetxattr, int, fd, const char __user *, name,
+		void __user *, value, size_t, size)
 {
 	struct file *f;
 	ssize_t error = -EBADF;
@@ -424,8 +421,8 @@ listxattr(struct dentry *d, char __user 
 	return error;
 }
 
-asmlinkage long
-sys_listxattr(const char __user *path, char __user *list, size_t size)
+SYSCALL_DEFINE3(listxattr, const char __user *, path, char __user *, list,
+		size_t, size)
 {
 	struct nameidata nd;
 	ssize_t error;
@@ -438,8 +435,8 @@ sys_listxattr(const char __user *path, c
 	return error;
 }
 
-asmlinkage long
-sys_llistxattr(const char __user *path, char __user *list, size_t size)
+SYSCALL_DEFINE3(llistxattr, const char __user *, path, char __user *, list,
+		size_t, size)
 {
 	struct nameidata nd;
 	ssize_t error;
@@ -452,8 +449,7 @@ sys_llistxattr(const char __user *path, 
 	return error;
 }
 
-asmlinkage long
-sys_flistxattr(int fd, char __user *list, size_t size)
+SYSCALL_DEFINE3(flistxattr, int, fd, char __user *, list, size_t, size)
 {
 	struct file *f;
 	ssize_t error = -EBADF;
@@ -485,8 +481,8 @@ removexattr(struct dentry *d, const char
 	return vfs_removexattr(d, kname);
 }
 
-asmlinkage long
-sys_removexattr(const char __user *path, const char __user *name)
+SYSCALL_DEFINE2(removexattr, const char __user *, path,
+		const char __user *, name)
 {
 	struct nameidata nd;
 	int error;
